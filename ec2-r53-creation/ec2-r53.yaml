 - name: create ec2-instance and r53 record
   hosts: local
   connection: local
   vars:
    ami_id: "ami-0220d79f3f480ecf5"
    sg_id: "sg-0303a0e47aba592a6"
    domain_name: "daws-86.shop"
    zone_id: Z0773171IVO7FQBRS7PI

   tasks:
    - name: create ec2 instance
      amazon.aws.ec2_instance:
        name: "{{ item }}"
        instance_type: "t3.micro"
        image_id: "{{ ami_id }}"
        security_group: "{{ sg_id }}"
        tags:
          Name: "{{ item }}"
      loop: "{{ instances }}"
      register: ec2_output
    
    - name: create r53 record 
      amazon.aws.route53:
        state: present
        zone: "{{ domain_name }}"
        ttl: 1
        type: A
        record: "{{ item .item }}.{{ domain_name }}"
        value: "{{ item.instances[0].private_ip_address }}"
        overwrite: true
      loop: "{{ ec2_output.results }}"
    - name: create r53 record 
      amazon.aws.route53:
        state: present
        zone: "{{ domain_name }}"
        ttl: 1
        type: A
        record: "{{ domain_name }}"
        value: "{{ item.instances[0].public_ip_address }}"
        overwrite: true
        when: item.item == "frontend"
      loop: "{{ ec2_output.results }}"
    

